<!DOCTYPE html>
<html lang="en"> 
<head>
    <title>ToDo App</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css" type="text/css"/>
</head>
<body>
<header>
    <div style="position: absolute; top: 0; right: 0; width: 200px;">
        <div aria-live="polite" aria-atomic="true" style="position: relative; min-height: 200px;">
            <div class="toast success" style="position: absolute; top: 0; right: 0;">
                <div class="toast-header">
                    <strong class="mr-auto">TODO App</strong>
                    <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="toast-body">
                    The note successfully added.
                </div>
            </div>
        </div>
    </div>
    <div style="position: absolute; top: 0; right: 0; width: 200px;">
        <div aria-live="polite" aria-atomic="true" style="position: relative; min-height: 200px;">
            <div class="toast error" style="position: absolute; top: 0; right: 0;">
                <div class="toast-header">
                    <strong class="mr-auto">TODO App</strong>
                    <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="toast-body">
                    Empty note could not be added.
                </div>
            </div>
        </div>
    </div>
    <div class="title">TODO App
    </div>
</header>

<div class="app-container app-block">
    <form>
        <span><input type="text" class="container-text" id="addText" placeholder="Add new note to list."/></span>
        <span><input type="button" id="addBtn" class="container-addnew" onclick="add()" value="Add" />
        </span>
    </form>
</div>

<div >
    <ul id="list">
    </ul>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.slim.js" integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY=" crossorigin="anonymous"></script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script>
    
        const list = document.getElementById("list");

        function generateId() {
            return Math.floor(Math.random() * 10000);
        }

        function createHTMLChild(itemName, value) {
            return `<li id="${itemName}" class="app-block" onclick="setState('${itemName}')" >
    <span>
    <img class="d-none" id="${itemName}icon" src="./success.png" width="28" height="28" style="padding:2px"/>
    ${value}
    </span>
    
    <span class="remove" onclick="removeItem('${itemName}')"></span>
    </li>`;
        }


        function add() {
            addNew(null, null);
        }
        function addNew(content, id) {

            const text = content || $("#addText").val();

            if (text === "" || text.match("/^\s+|\s+$/g")) {
                $('.error').toast('show');
                return;
            }

            let index = id || "todo" + (generateId());
            let newChild = createHTMLChild(index, text);
            list.innerHTML = list.innerHTML + " " + newChild;

            $('.success').toast("show");
            $("#addText").val('');

            var todos = localStorage.getItem("todos");

            todos = JSON.parse(todos);

            if (todos == null) {
                todos = {};
            }
            todos[index.toLowerCase()] = {
                content: text.toLowerCase(),
                state: todos[index.toLowerCase()] ? todos[index.toLowerCase()].state : "continued"
            }
            localStorage.setItem("todos", JSON.stringify(todos));
        }

        function removeItem(itemName) {
            let item = document.getElementById(itemName);

            if (!item) return;
            var todos = localStorage.getItem("todos");

            todos = JSON.parse(todos);

            delete todos[itemName];

            if (Object.keys(todos).length === 0) localStorage.removeItem("todos");
            else
                localStorage.setItem("todos", JSON.stringify(todos));

            let parent = item.parentNode;
            parent.removeChild(item);

        }

        function setState(itemName) {
            let item = $("#" + itemName);
            let successIcon = $("#" + itemName + "icon");

            var todos = localStorage.getItem("todos");
            todos = JSON.parse(todos);

            if (item.hasClass("checked")) {

                item.removeClass("checked");
                successIcon.addClass("d-none");
                todos[itemName.toLowerCase()].state = "continued";
                localStorage.setItem("todos", JSON.stringify(todos));
            }
            else {

                item.addClass("checked");
                successIcon.removeClass("d-none");

                if (!todos || Object.keys(todos).length === 0) return;

                if (!todos[itemName.toLowerCase()])
                    return;

                todos[itemName.toLowerCase()].state = "finished";
                localStorage.setItem("todos", JSON.stringify(todos));
            }
        }

        function load() {

            var todos = localStorage.getItem("todos");
            todos = JSON.parse(todos);

            if (!todos) return;

            for (var item in todos) {
                addNew(todos[item].content, item);

                let comp = $("#" + item);
                let successIcon = $("#" + item + "icon");

                if (todos[item].state === "finished") {
                    comp.addClass("checked");
                    successIcon.removeClass("d-none");
                }
                else {
                    comp.removeClass("checked");
                    successIcon.addClass("d-none");
                }
            }
        };


        load();
</script>
</body>
</html>